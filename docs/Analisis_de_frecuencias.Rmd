---
output:
  word_document: default
  html_document: default
header-includes:
- \usepackage{float}
- \floatstyle{boxed}
- \restylefloat{figure}
---

<div style="display:flex; align-items:center;">
  <h1 style="margin:0;">Análisis de frecuencias</h1>
  <img src="Imagenes/HNBI_LOGO1.jpeg" alt="Texto alternativo de la imagen" style="width:100px; margin-left:20px;">
</div>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Contenido{.tabset .tabset-pills}

#### Chi-cuadrado

Cuando hay dos frecuencias en un grupo de datos comunmente se hace un **Chi-cuadrado** para ver si un grupo es mayor que el otro.

```{r}
x <- c(RM = 54, B = 46)
```

La función para ejecutar la prueba de Chi-cuadrado es `chisq.test()`.

```{r}
chisq.test(x)
```

Se interpreta el valor de P tomando como referencia el valor de alpha que por defecto es de 0.05. Si P < 0.05, si hay diferencias estadísticamente significativas entre los dos grupos. Si P ≥ 0.05, los grupos no presentan diferencias estadísticamente significativas.
Al aumentar el tamaño de la muestra se consigue la significancia del valor de P.

```{r}
y <- c(RM = 170, B = 130)
```

```{r}
chisq.test(y)
```

La fórmula del Chi-cuadrado es la siguiente:

$$
X^2 = \Sigma \frac{(O-E)^2}E
$$
Donde:

  O = valores observados

  E = valores esperados
  
```{r}
chi <- chisq.test(y)
```

```{r}
chi$expected
```

```{r}
chi$observed
```

```{r}
chi$statistic
```

```{r}
chi$residuals
```

```{r}
chi$stdres
```

#### Proporciones para datos binomiales

Para conocer las proporciones de cada grupo respecto al total de la muestra podemos utilizar la función `binom.test()` (para datos binomiales).

```{r}
binom.test(170, 300)
```

```{r}
binom.test(130, 300)
```

#### Estimación de parámetros para proporciones

También podemos estimar la diferencia (en proporción) entre los dos grupos con la función `BinomDiffCI()` del paquete `DescTools`

```{r}
library(DescTools)
```

```{r}
BinomDiffCI(170, 300, 130, 300)
```

Aquí, la diferencia es del 13% y se puede decir con un 95% de confianza que la verdadera diferencia entre los dos grupos está entre 5 y 21%

También se puede conocer la proporción cuando hay más de dos grupos (datos multinomiales) con la función `MultinomCI()` del paquete `DescTools`.

```{r}
MultinomCI(c(170, 130, 105))
```

El estimado es la proporción (%) para cada grupo, y también muestra su intervalo de confianza.

#### Tablas de contingencia

Las tablas de contingencia son matrices que muestras la distribución de frecuencias de las variables y son muy utilizadas cuando se realizan encuestas.

```{r}
library(rio)
```

Para este ejercicio utilizaremos la base de datos de oncocercosis (seguera de rio provocada por un nematodo).

```{r}
onco <- import("data/oncocercosis.xlsx")
head(onco)
```

Resuminos los datos en una tabla de contingencia

```{r}
cont <- table(onco$mf, onco$area)
cont
```

También se puede elaborar una tabla más compleja con la función `tbl_cross()` del paquete `gtsummary`.

```{r}
library(gtsummary)
```

```{r}
cont2 <- tbl_cross(onco, mf, area, percent = "cell")
cont2
```

También podemos representarlo de forma gráfica con la función `mosaic()` del paquete `vcd`

```{r}
library(vcd)
```

```{r}
mosaic(~ mf + area, data = onco, shade = T)
```

Parece que hay una relación entre las personas infectadas y que vienen de Rainforest. Esta prueba evalua la igualdad de proporciones y la independencia de los datos.

**Igualdad de proporciones:** El análisis de esos datos dio una diferencia significativa (entre proporciones) analizada con un chi sqrt

**Independencia de los datos:** También prueba la independencia de los datos evaluados, si los datos que vienen de un lado son independientes de los que vienen del otro lado

Los grises en el gráfico representan los valores que están dentro de los valores esperados
El azul son los que se pasaron del esperado y el rosado son los que están por debajo de lo que se esperaba

Si hacemos una prueba de Chi-cuadrado de nuestra tabla tendremos lo siguiente:

```{r}
chicont <- chisq.test(cont)
chicont
```

```{r}
chicont$expected
```

```{r}
chicont$observed
```

```{r}
chicont$residuals
```

Los residuales que se pasan de -2 o 2 son los que provocan la significancia estadística.

```{r}
chicont$stdres
```

<br>